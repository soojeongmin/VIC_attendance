<!DOCTYPE html>
<html>
<head>
  <base target="_top" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>좌석 조회 - 2학년</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      width: 100%;
      max-width: 500px;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 2em;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 0.9em;
    }

    .search-box {
      margin-bottom: 30px;
    }

    .search-box label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: bold;
    }

    .search-input-group {
      display: flex;
      gap: 10px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    .result-area {
      display: none;
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
      animation: fadeIn 0.3s;
    }

    .result-area.show {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .student-info {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .student-info h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #666;
      font-weight: bold;
    }

    .info-value {
      color: #333;
    }

    .seat-button {
      width: 100%;
      padding: 16px;
      margin-top: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .seat-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .seat-button:active {
      transform: translateY(0);
    }

    .no-result {
      text-align: center;
      color: #666;
      padding: 30px;
      font-size: 1.1em;
    }

    .loading {
      text-align: center;
      color: #667eea;
      padding: 20px;
      font-size: 1em;
    }

    .error {
      background: #fee;
      color: #c33;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
    }

    /* 좌석 배치도 모달 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      animation: fadeIn 0.3s;
    }

    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 30px;
      border-radius: 20px;
      width: 95%;
      max-width: 1200px;
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
    }

    .close {
      position: absolute;
      right: 20px;
      top: 20px;
      color: #aaa;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
      z-index: 10;
    }

    .close:hover {
      color: #000;
    }

    .classroom-title {
      text-align: center;
      color: #667eea;
      margin-bottom: 30px;
      font-size: 2em;
    }

    #seatGrid {
      padding: 0 20px;
    }

    .seat-row {
      display: flex;
      flex-wrap: nowrap;
      justify-content: flex-start;
      margin-bottom: 10px;
    }

    .spacer {
      width: 40px;
    }

    .seat {
      min-width: 60px;
      height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 0.75em;
      line-height: 1.2;
      overflow: hidden;
      border: 2px solid #ddd;
      border-radius: 6px;
      background: white;
      margin: 2px;
      cursor: default;
      transition: all 0.3s;
      padding: 4px;
    }

    .seat span {
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .seatId {
      font-weight: bold;
      color: #333;
      font-size: 0.9em;
    }

    .studentName {
      color: #666;
      font-size: 0.85em;
    }

    .empty-seat {
      visibility: hidden !important;
    }

    .seat.highlight {
      border: 4px solid #ff0000 !important;
      background: #ffe0e0 !important;
      animation: pulse 1.5s infinite;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
      transform: scale(1.1);
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1.1);
      }
      50% {
        transform: scale(1.15);
      }
    }

    /* 반응형 */
    @media (max-width: 600px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 1.5em;
      }

      .modal-content {
        padding: 20px;
        margin: 10% auto;
      }

      .seat {
        min-width: 50px;
        height: 50px;
        font-size: 0.65em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>좌석 검색 (2학년)</h1>
    <p class="subtitle">학번을 입력하여 자리를 확인하세요</p>

    <div class="search-box">
      <label for="studentId">학번:</label>
      <div class="search-input-group">
        <input type="text" id="studentId" placeholder="20000" />
        <button onclick="searchSeat()">검색</button>
      </div>
    </div>

    <div id="resultArea" class="result-area"></div>
  </div>

  <!-- 좌석 배치도 모달 -->
  <div id="seatModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalClassroom" class="classroom-title"></h2>
      <div id="seatGrid"></div>
    </div>
  </div>

  <script>
    let studentMap = {};
    let currentStudent = null;

    // 전체 학생 데이터 로드
    function loadStudentData() {
      google.script.run
        .withSuccessHandler(function(data) {
          studentMap = data;
          console.log("학생 데이터 로드 완료:", Object.keys(studentMap).length + "명");
        })
        .withFailureHandler(function(error) {
          console.error("데이터 로드 실패:", error);
        })
        .getStudentMap();
    }

    // 학번으로 검색
    function searchSeat() {
      const studentId = document.getElementById('studentId').value.trim();
      const resultArea = document.getElementById('resultArea');

      if (!studentId) {
        alert("학번을 입력해주세요.");
        return;
      }

      resultArea.innerHTML = '<div class="loading">검색 중...</div>';
      resultArea.classList.add('show');

      google.script.run
        .withSuccessHandler(displayResult)
        .withFailureHandler(function(error) {
          resultArea.innerHTML = '<div class="error">검색 중 오류가 발생했습니다.<br>' + error.message + '</div>';
        })
        .searchStudentByStudentId(studentId);
    }

    // 검색 결과 표시
    function displayResult(student) {
      const resultArea = document.getElementById('resultArea');

      if (!student) {
        resultArea.innerHTML = '<div class="no-result">검색 결과가 없습니다.<br>학번을 확인해주세요.</div>';
        return;
      }

      const displaySeat = student.movedSeat || student.seat;
      const displayClassroom = student.movedSeat ? student.movedSeat.split('-')[0] : student.classroom;
      const moveInfo = student.movedSeat ? ' (발전실 이동)' : '';

      let html = '<div class="student-info">';
      html += '<h3>학생 정보</h3>';
      html += `
        <div class="info-row">
          <span class="info-label">이름</span>
          <span class="info-value">${student.name}</span>
        </div>
        <div class="info-row">
          <span class="info-label">학번</span>
          <span class="info-value">${student.studentId}</span>
        </div>
        <div class="info-row">
          <span class="info-label">HR</span>
          <span class="info-value">${student.hr}</span>
        </div>
        <div class="info-row">
          <span class="info-label">좌석</span>
          <span class="info-value">${displaySeat}${moveInfo}</span>
        </div>
        <div class="info-row">
          <span class="info-label">교실</span>
          <span class="info-value">${displayClassroom}</span>
        </div>
        <button class="seat-button" onclick='showSeatMap(${JSON.stringify(student)})'>
          좌석 위치 보기
        </button>
      `;
      html += '</div>';

      resultArea.innerHTML = html;
    }

    // 좌석 배치도 표시
    function showSeatMap(student) {
      currentStudent = student;
      const modal = document.getElementById('seatModal');
      const modalClassroom = document.getElementById('modalClassroom');
      const seatGrid = document.getElementById('seatGrid');

      const displaySeat = student.movedSeat || student.seat;
      const displayClassroom = student.movedSeat ? student.movedSeat.split('-')[0] : student.classroom;

      modalClassroom.textContent = displayClassroom;

      // 교실별 그리기 함수 매핑 (2학년부)
      const drawFunctions = {
        '3A': draw3ASeats,
        '3B': draw3BSeats,
        '3C': draw3CSeats,
        '3D': draw3DSeats,
        'C306': drawC306Seats,
        'C307': drawC307Seats,
        'C309': drawC309Seats
      };

      const drawFn = drawFunctions[displayClassroom];
      if (drawFn) {
        drawFn(displaySeat);
      } else {
        alert("해당 교실의 좌석 배치 정보가 없습니다.");
        return;
      }

      modal.style.display = 'block';

      // 하이라이트된 좌석으로 스크롤
      setTimeout(() => {
        const highlightedSeat = document.querySelector('.seat.highlight');
        if (highlightedSeat) {
          highlightedSeat.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }, 100);
    }

    // 레이아웃 렌더링 함수
    function renderSeatLayout(layout, highlightSeat) {
      const grid = document.getElementById("seatGrid");
      grid.innerHTML = "";

      layout.forEach(row => {
        if (row[0] === "br") {
          const br = document.createElement("div");
          br.style.height = "24px";
          grid.appendChild(br);
        } else {
          const rowDiv = document.createElement("div");
          rowDiv.className = "seat-row";
          row.forEach(cell => {
            if (cell === "sp") {
              const spacer = document.createElement("div");
              spacer.className = "spacer";
              rowDiv.appendChild(spacer);
            } else if (cell === "empty") {
              const emptyBtn = document.createElement("div");
              emptyBtn.className = "seat empty-seat";
              rowDiv.appendChild(emptyBtn);
            } else {
              rowDiv.appendChild(createSeatElement(cell, highlightSeat));
            }
          });
          grid.appendChild(rowDiv);
        }
      });
    }

    // 좌석 요소 생성
    function createSeatElement(seatId, highlightSeat) {
      const div = document.createElement("div");
      div.className = "seat";
      div.dataset.seatId = seatId;

      const student = studentMap[seatId];
      const name = student?.name?.trim() || "";

      // 하이라이트 체크
      const isHighlight = highlightSeat === seatId;
      if (isHighlight) {
        div.classList.add('highlight');
      }

      div.innerHTML = `
        <span class="seatId">${seatId}</span>
        <span class="studentName">${name}</span>
      `;

      return div;
    }

    // 3A 교실 레이아웃
    function draw3ASeats(highlightSeat) {
      const layout = [
        ["3A121", "sp", "3A120", "3A119", "3A118", "sp", "3A117", "3A116", "3A115", "3A114", "3A113", "3A112"],
        ["3A122", "sp", "3A111", "3A110", "3A109", "sp", "3A108", "3A107", "3A106", "3A105", "3A104", "3A103"],
        ["3A123", "sp", "empty", "empty", "empty", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A124", "sp", "3A102", "3A101", "3A100", "sp", "3A099", "3A098", "3A097", "3A096", "3A095", "3A094"],
        ["3A125", "sp", "3A093", "3A092", "3A091", "sp", "3A090", "3A089", "3A088", "3A087", "3A086", "3A085"],
        ["3A126", "sp", "empty", "empty", "empty", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A127", "sp", "3A084", "3A083", "3A082", "sp", "empty", "3A081", "3A080", "3A079", "3A078", "empty"],
        ["3A128", "sp", "3A077", "3A076", "3A075", "sp", "empty", "3A074", "3A073", "3A072", "3A071", "empty"],
        ["3A129", "sp", "empty", "empty", "empty", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["br"],
        ["empty", "sp", "3A070", "3A069", "3A068", "sp", "3A067", "3A066", "3A065", "3A064", "3A063", "3A062"],
        ["3A130", "sp", "3A061", "3A060", "3A059", "sp", "3A058", "3A057", "3A056", "3A055", "3A054", "3A053"],
        ["3A131", "sp", "empty", "empty", "empty", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A132", "sp", "3A052", "3A051", "3A050", "sp", "3A049", "3A048", "3A047", "3A046", "3A045", "3A044"],
        ["3A133", "sp", "3A043", "3A042", "3A041", "sp", "3A040", "3A039", "3A038", "3A037", "3A036", "3A035"],
        ["3A134", "sp", "empty", "empty", "empty", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A135", "sp", "3A034", "3A033", "3A032", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A136", "sp", "3A031", "3A030", "3A029", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A137", "sp", "empty", "empty", "empty", "sp", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A138", "sp", "3A028", "3A027", "3A026", "3A025", "3A024", "3A023", "3A022", "3A021", "3A020", "3A019"],
        ["empty", "sp", "3A018", "3A017", "3A016", "3A015", "3A014", "3A013", "3A012", "3A011", "3A010", "3A009"],
        ["3A139", "sp", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A140", "sp", "3A008", "3A007", "3A006", "3A005", "3A004", "3A003", "3A002", "3A001", "empty", "empty"],
        ["3A141", "sp", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"],
        ["3A142", "sp", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty", "empty"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // 3B 교실 레이아웃
    function draw3BSeats(highlightSeat) {
      const layout = [
        ["3B092", "3B091", "3B090", "3B089", "3B088", "sp", "3B087", "3B086", "3B085", "3B084", "3B083", "sp", "sp", "3B082", "3B081", "3B080", "3B079", "3B078", "sp", "3B077", "3B076", "3B075", "3B074", "3B073"],
        ["3B072", "3B071", "3B070", "3B069", "3B068", "sp", "3B067", "3B066", "3B065", "3B064", "3B063", "sp", "sp", "3B062", "3B061", "3B060", "3B059", "3B058", "sp", "3B057", "3B056", "3B055", "3B054", "3B053"],
        ["br"],
        ["3B052", "3B051", "3B050", "3B049", "3B048", "sp", "3B047", "3B046", "3B045", "3B044", "3B043", "sp", "sp", "3B042", "3B041", "3B040", "3B039", "3B038", "sp", "3B037", "3B036", "3B035", "3B034", "3B033"],
        ["3B032", "3B031", "3B030", "3B029", "3B028", "sp", "3B027", "3B026", "3B025", "3B024", "3B023", "sp", "sp", "3B022", "3B021", "3B020", "3B019", "3B018", "sp", "3B017", "3B016", "3B015", "3B014", "3B013"],
        ["br"],
        ["3B012", "3B011", "3B010", "3B009", "3B008", "sp", "empty", "3B007", "3B006", "3B005", "3B004", "sp", "sp", "empty", "empty", "empty", "empty", "empty", "sp", "3B003", "3B002", "3B001"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // 3C 교실 레이아웃
    function draw3CSeats(highlightSeat) {
      const layout = [
        ["3C022", "3C021", "3C020", "3C019", "3C018"],
        ["3C017", "3C016", "3C015", "3C014", "3C013"],
        ["br"],
        ["3C012", "3C011", "3C010", "3C009", "3C008"],
        ["3C007", "3C006", "3C005", "3C004", "3C003"],
        ["br"],
        ["empty", "empty", "empty", "3C002", "3C001"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // 3D 교실 레이아웃
    function draw3DSeats(highlightSeat) {
      const layout = [
        ["3D122", "3D121", "3D120", "3D119", "3D118", "3D117", "sp", "3D116", "3D115", "3D114", "3D113", "3D112"],
        ["3D111", "3D110", "3D109", "3D108", "3D107", "3D106", "sp", "3D105", "3D104", "3D103", "3D102", "3D101"],
        ["br"],
        ["3D100", "3D099", "3D098", "3D097", "3D096", "3D095", "sp", "3D094", "3D093", "3D092", "3D091", "3D090"],
        ["3D089", "3D088", "3D087", "3D086", "3D085", "3D084", "sp", "3D083", "empty", "empty", "3D082", "3D081"],
        ["br"],
        ["3D080", "3D079", "3D078", "3D077", "3D076", "3D075", "sp", "3D074", "3D073", "3D072", "3D071", "3D070"],
        ["3D069", "3D068", "3D067", "3D066", "3D065", "3D064", "sp", "3D063", "3D062", "3D061", "3D060", "3D059"],
        ["br"],
        ["3D058", "3D057", "3D056", "3D055", "3D054", "3D053", "sp", "3D052", "3D051", "3D050", "3D049", "3D048"],
        ["3D047", "3D046", "3D045", "3D044", "3D043", "3D042", "sp", "3D041", "3D040", "3D039", "3D038", "3D037"],
        ["br"],
        ["3D036", "3D035", "3D034", "3D033", "3D032", "3D031", "sp", "3D030", "empty", "empty", "3D029", "3D028"],
        ["3D027", "3D026", "3D025", "3D024", "3D023", "3D022", "sp", "3D021", "3D020", "3D019", "3D018", "3D017"],
        ["br"],
        ["empty", "3D016", "3D015", "3D014", "3D013", "3D012", "sp", "3D011", "3D010", "3D009", "3D008", "3D007"],
        ["empty", "empty", "empty", "empty", "empty", "3D006", "sp", "3D005", "3D004", "3D003", "3D002", "3D001"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // C306 교실 레이아웃
    function drawC306Seats(highlightSeat) {
      const layout = [
        ["C306-001", "C306-006", "C306-011", "C306-016", "C306-021", "C306-026"],
        ["br"],
        ["C306-002", "C306-007", "C306-012", "C306-017", "C306-022", "C306-027"],
        ["br"],
        ["C306-003", "C306-008", "C306-013", "C306-018", "C306-023", "C306-028"],
        ["br"],
        ["C306-004", "C306-009", "C306-014", "C306-019", "C306-024", "C306-029"],
        ["br"],
        ["C306-005", "C306-010", "C306-015", "C306-020", "C306-025", "C306-030"],
        ["br"],
        ["C306-031", "C306-032", "C306-033", "C306-034", "C306-035", "C306-036"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // C307 교실 레이아웃
    function drawC307Seats(highlightSeat) {
      const layout = [
        ["C307-001", "C307-006", "C307-011", "C307-016", "C307-021", "C307-026"],
        ["br"],
        ["C307-002", "C307-007", "C307-012", "C307-017", "C307-022", "C307-027"],
        ["br"],
        ["C307-003", "C307-008", "C307-013", "C307-018", "C307-023", "C307-028"],
        ["br"],
        ["C307-004", "C307-009", "C307-014", "C307-019", "C307-024", "C307-029"],
        ["br"],
        ["C307-005", "C307-010", "C307-015", "C307-020", "C307-025", "C307-030"],
        ["br"],
        ["C307-031", "C307-032", "C307-033", "C307-034", "C307-035", "C307-036"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // C309 교실 레이아웃 (발전실)
    function drawC309Seats(highlightSeat) {
      const layout = [
        ["C309-001", "C309-006", "C309-011", "C309-016", "C309-021", "C309-026"],
        ["br"],
        ["C309-002", "C309-007", "C309-012", "C309-017", "C309-022", "C309-027"],
        ["br"],
        ["C309-003", "C309-008", "C309-013", "C309-018", "C309-023", "C309-028"],
        ["br"],
        ["C309-004", "C309-009", "C309-014", "C309-019", "C309-024", "C309-029"],
        ["br"],
        ["C309-005", "C309-010", "C309-015", "C309-020", "C309-025", "C309-030"],
        ["br"],
        ["C309-031", "C309-032", "C309-033", "C309-034", "C309-035", "C309-036"]
      ];
      renderSeatLayout(layout, highlightSeat);
    }

    // 모달 닫기
    function closeModal() {
      document.getElementById('seatModal').style.display = 'none';
    }

    // 모달 외부 클릭 시 닫기
    window.onclick = function(event) {
      const modal = document.getElementById('seatModal');
      if (event.target === modal) {
        closeModal();
      }
    }

    // Enter 키로 검색
    document.getElementById('studentId').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchSeat();
      }
    });

    // 페이지 로드 시 학생 데이터 불러오기
    window.onload = function() {
      loadStudentData();
    };
  </script>
</body>
</html>
